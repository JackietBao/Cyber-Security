# 聊聊登录鉴权那些事儿

北银金科天才团 [北银金科逐浪青春](javascript:void(0);) *2024年10月21日 09:44* *北京*

![图片](assets/聊聊登录鉴权那些事儿/640.webp)



*01*

**引言**





在数字化时代，随着网络应用的普及和深入，用户登录鉴权成为了保障系统安全的第一道防线。登录鉴权技术通过验证用户身份和权限，确保只有合法用户才能访问系统资源。本文将详细介绍登录鉴权的技术原理、常用方法和最佳实践，为系统安全提供有力保障。



*02*

**登录鉴权技术原理**

**Y**



登录鉴权技术主要基于三个核心要素：用户身份、用户凭证和鉴权机制。用户身份是用户在网络空间中的唯一标识，如用户名、邮箱地址等。用户凭证是用户用于证明自己身份的信息，如密码、动态验证码等。鉴权机制则是系统用于验证用户身份和权限的过程，包括身份验证和权限验证两个环节。



*03*

**实施路径**

**Y**

**
**

***\**\*3.1\*\* \*\*http基本鉴权\*\**\***



http基本鉴权加解密过程如下：

(1) 请求一个受限内容；

(2) 输入账号密码；

(3) 组合用户名和密码，然后Base64编码；

(4) 在http请求头中加入“basic+编码后的字符串”，basic是验证模式。



![图片](assets/聊聊登录鉴权那些事儿/640-17335028774361.webp)



**优点：**

**(1)** **简单直接**

HTTP基本鉴权通过在HTTP请求头中包含用户名和密码（以Base64编码格式）来实现身份验证，这种方式简单直接，易于理解和实现。



**(2)** **跨平台性强**

由于HTTP协议是通用的网络协议，HTTP基本鉴权可以跨不同的操作系统和编程语言进行实现，具有良好的跨平台性。



**缺点：**

**(1)** **明文传输**

HTTP基本鉴权将用户名和密码以Base64编码格式进行传输，但这种编码并不是加密，而是可逆的。因此，如果网络中存在恶意监听者，他们很容易就可以获取到用户名和密码。



**(2)** **安全性低**

由于HTTP基本鉴权只提供了简单的身份验证机制，而没有提供加密、签名等安全特性，因此其安全性相对较低。例如，它无法防止重放攻击（Replay Attack）和中间人攻击（Man-in-the-Middle Attack）等。



**(3)** **用户体验差**

HTTP基本鉴权要求用户在每次发送请求时都携带用户名和密码，这可能会降低用户体验。尤其是在移动设备上，用户可能需要频繁地输入用户名和密码。



***\**\*3.2 Cookie+Seession\*\**\***



注册时，服务器在接收到注册账号密码之后，使用足够长且随机的salt值对密码进行加密，来达到数据防泄露的目的。



注册流程如下：



![图片](assets/聊聊登录鉴权那些事儿/640-17335028774372.webp)



登录时，服务器通过salt值与密码进行SHA加密与数据库中的password进行比对，确定密码正确；创建一个sesssion对象并把sessionId通过cookie的形式保存在浏览器中，浏览器发送请求时带上cookie值sessionId，服务器端通过解析sessionId获取用户身份，进行业务操作。



登录流程如下：


![图片](assets/聊聊登录鉴权那些事儿/640-17335028774373.webp)



更新session操作：session的过期时间比较短，为了避免用户频繁登录，session的过期时间理应随着用户的操作延长，需要刷新session。以 Koa 为例，开发一个 middleware（默认情况下所有请求都会经过该 middleware），如果校验 Session 有效，就更新 Session 的 expires: 当前时间+过期时间。



更新session流程如下：



![图片](assets/聊聊登录鉴权那些事儿/640-17335028774374.webp)



**优点：**

**(1)** **信息存储方便**

Cookie可以将用户信息等存储在客户端，使得用户可以跨页面访问，比较方便。Session则是将用户相关的数据存储在服务器端，确保了数据的安全性和可靠性。



**(2)** **实现简单**

Cookie机制实现简单，只需要服务器端向客户端发送Set-Cookie即可完成鉴权，不需要过多的复杂设置。而Session机制是在Cookie的基础上实现的，通过验证Session ID的有效性来允许用户访问资源。



**(3)** **可扩展性和可用性**

通过良好的编程，可以控制保存在cookie中的session对象的大小，同时可以使用加密和安全传输技术（如SSL），减少cookie被破解的可能性。此外，只在cookie中存放不敏感数据，即使被盗也不会有重大损失。



**缺点：**

**(1)** **安全性问题**

Cookie存储在客户端，如果cookie被人拦截，攻击者就可以取得所有的session信息。即使使用了加密技术，拦截者也可以原样转发cookie来达到目的。Session虽然信息存储在服务器端，安全性较高，但在分布式系统中，需要额外的处理来确保多台服务器之间的Session共享，从而增加了复杂性。



**(2)** **维护负担**

Session存储在服务器端，需要服务器端定期清理过期的Session数据，从而增加了服务器的负担。



**(3)** **资源开销**

对于服务器来说，存储所有的在线用户Session ID会占用大量的内存和CPU资源。随着在线用户数量的增加，这可能会对服务器性能产生严重影响。



**(4)** **限制和依赖**

Cookie有数量和长度的限制，每个domain最多只能有20条cookie，每个cookie长度不能超过4KB，否则会被截掉。同时，如果用户的浏览器设置为不接受任何cookie，那么基于cookie的Session鉴权将无法正常工作。

**
**

***\**\*3.3\*\* \*\*Token\*\**\***

**
**

Token，通常叫做令牌，是一种自定义实现的类似Session/Cookie机制的，用来代替传统Session/Cookie的新兴鉴权方案，当前很多的应用API鉴权就是使用的Token令牌。



Token是服务端生成的一串加密字符串，用户在登录成功后生成并返回给客户端，之后客户端的每次请求都会通过GET/POST/Header等方式携带Token，服务端通过验证Token的有效性来完成鉴权。



一般 Token 的组成：uid (用户唯一的身份标识) + time (当前时间的时间戳) + sign (签名，Token 的前几位以哈希算法压缩成的一定长度的十六进制字符串)



基于Token的鉴权方式的完整流程为：



(1) 客户端用户通过用户和密码进行首次登录；

(2) 服务端接收用户请求，并验证用户名和密码的正确性，登录验证成功后根据自定义规则生成Token信息；

(3) 服务端将生成的Token通过响应返回给客户端；

(4) 客户端将Token信息存储在本地；

(5) 客户端在之后的每次请求中携带Token信息；

(6) 服务端针获取请求中的Token，并根据定义的验证机制判断Token合法性，验证成功获取用户信息，保持用户状态；

(7) Token存活时间达到设置的有效期后自动失效，此后用户请求时Token验证不通过，需要用户重新登录验证。



token校验的流程如下：



![图片](assets/聊聊登录鉴权那些事儿/640-17335028774375.webp)



**优点：**

**(1)** **无状态**

Token本身包含了认证信息，因此服务端不需要存储会话信息，减轻了服务端压力。



**(2)** **安全性**

相比基于Cookie的认证方式，Token不易被截获或伪造，因为它通常具有较短的过期时间和较高的随机性。



**(3)** **跨域性**

Token认证方式支持跨域，前端和后端只需要通过接口进行通信，前端获取到Token后可以存到任何地方，比如localStorage、Cookie或SessionStorage等。



**缺点：**

**(1)** **有效期问题**

Token一般具有较短的过期时间（如一到两个小时），以降低泄露风险。但这也可能导致Token过期后用户需要重新登录或获取新的Token。



**(2)** **存储问题**

虽然Token可以存储在前端，但这也可能带来安全风险，如XSS攻击可能会窃取Token。



**(3)** **Token刷新**

为了解决Token过期的问题，需要使用refresh_token或其他机制来刷新Token，这增加了系统的复杂性。

**
**

***\**\*3.4 JWT\*\**\***

***\**\*
\*\**\***

JWT全称JSON Web Token，是一个字符串书写规范，作用是用来在用户和服务器之间传递安全可靠的信息，它由三部分组成：头部、载荷、签名。



**3.4.1 头部**

头部用于描述关于该JWT的最基本的信息，例如其类型以及签名所用的算法等。这也可以被表示成一个JSON对象，下例中在头部指明了签名算法是HS256算法，然后对它进行base64编码，形成第一部分eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9

头部示例：{"typ":"JWT","alg":"HS256"}



**3.4.2 荷载（payload）**

荷载就是存放有效信息的地方，Payload部分的数据可以分为三种类型：



**（1）****Registered claims（注册的声明）**

这些是一组预定义的声明，写在JWT标准中，但并不是强制要求携带的。这些字段包括：

iss(issuer)：签发者

exp(expiration time)：过期时间

sub(subject)：面向的用户

aud(audience)：接收者

iat(issued at)：签发时间

nbf(not before)：在此之前不可用

jti(JWT ID)：JWT的唯一标识

这些字段在JWT标准中有明确的定义和用法。



**（2）****Public claims（公共的声明）**

这些声明可以随意定义，通常用于存放一些用户ID、用户类型等非敏感信息，这些声明应该避免与注册声明的名称冲突。



**（3）****Private claims（私有的声明）**

这些声明是自定义的，用于在JWT中存储一些特定的应用信息，这些声明应该使用不与IETF JSON中任何已定义的注册名称相冲突的URI作为名称。



Payload中的数据是以JSON的形式存在的，但是需要注意的是，为了能在URL和HTTP headers中安全地传输，JWT中的Payload部分会被Base64编码。



在JWT中，Payload部分并不直接提供数据的完整性和真实性的保证。这是通过Signature部分来实现的，Signature部分使用Header中指定的算法对Header和Payload进行签名，以确保JWT在传输过程中没有被篡改。



**（4）签证（signature）**

jwt的第三部分是一个签证信息，这个签证信息由三部分组成：header (base64后的)、payload(base64后的)、secret。这个部分需要base64加密后的header和base64加密后的payload使用“.”连接组成的字符串，然后通过header中声明的加密方式进行secret组合加密，然后就构成了jwt的第三部分。TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ



将这三部分用“.”连接成一个完整的字符串,构成了最终的jwt：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ



JWT鉴权流程如下：

**
**

**![图片](assets/聊聊登录鉴权那些事儿/640-17335028774376.webp)
**



**优点：**

**(1)** **简洁性：**JWT使用JSON数据结构表示Token，具有较小的数据体积，便于传输和存储。



**(2)** **可扩展性：**JWT支持自定义的声明（Claim），可以根据需要包含更多的用户信息或其他业务逻辑所需的信息。



**(3)** **无状态：**JWT不依赖会话，服务器不需要保存会话状态，降低了服务器的开销。



**(4)** **安全性：**JWT使用数字签名或加密算法对数据进行验证和防篡改，确保信息在传输过程中的安全性。



**(5)** **跨域支持：**由于Token的传输和验证都是在HTTP头部进行的，因此JWT支持跨域请求。



**(6)** **前后端分离：**JWT可以轻松地在前后端分离的架构中使用，前端通过在请求中携带JWT进行身份验证，后端只需对JWT进行验证和解析即可。



**(7)** **缓存优化：**由于JWT包含了用户的身份信息，因此可以减少对数据库频繁的查询和访问，提高系统性能。



**缺点：**

**(1)** **不可撤销：**JWT的令牌创建后，后端无法销毁。如果需要销毁令牌，需要开发短时间有效期的token刷新机制。



**(2)** **令牌大小：**JWT中包含了头部、载荷和签名三部分信息，如果使用RSA算法进行签名，令牌会比较大，可能会增加网络传输的负担。



**(3)** **存储问题：**由于JWT是无状态的，令牌中包含了用户信息，如果令牌被盗取，攻击者可以获得用户的敏感信息，因此需要对令牌进行严格的存储和管理。



**(4)** **安全性问题：**虽然JWT使用数字签名或加密算法保证令牌的真实性和完整性，但如果密钥被泄露，攻击者可以篡改令牌，因此需要对密钥进行保护和管理。



**(5)** **不支持多级会话：**JWT不支持多级会话，即无法在令牌中存储多个会话信息，对于一些复杂的应用场景，可能需要使用其他的身份验证和授权机制。

**
**

***\*3.5\** \**OAuth\****

***\*
\****

OAuth登录是一种授权框架，它允许第三方应用获取有限的访问权限，而无需得到用户的用户名和密码。



OAuth登录的基本流程如下：



**(1)** **用户请求授权**

用户在第三方应用中请求访问受保护的资源，但由于这些资源受到保护，因此需要进行授权。



**(2)** **授权服务器认证**

第三方应用将用户重定向到授权服务器，授权服务器要求用户进行身份验证。



**(3)** **用户授权**

一旦用户通过身份验证，授权服务器会要求用户授权第三方应用访问其受保护的资源。



**(4)** **授权颁发**

用户同意授权后，授权服务器会颁发访问令牌（Access Token）给第三方应用。



**(5)** **访问受保护资源**

第三方应用使用访问令牌向资源服务器请求访问受保护资源。



**关键点**

**(1)** **安全性：**OAuth通过不直接传输用户名和密码来提高安全性。第三方应用只获得有限的访问权限，而不是用户的完整凭据。



**(2)** **灵活性：**OAuth支持多种授权模式，包括客户端模式、密码模式、授权码模式等，以适应不同的应用场景。



**(3)** **用户体验：**OAuth允许用户使用他们已有的社交媒体账户或身份提供商账户进行登录，从而提高用户体验和便捷性。



OAuth通常用于以下场景：



**(1)** **社交媒体登录：**允许用户使用他们的社交媒体账户（如Facebook、Google等）登录第三方应用。



**(2)** **API访问：**允许第三方应用通过API访问用户的受保护资源，如照片、视频、联系人等。



**(3)** **企业身份管理：**在企业环境中，OAuth可用于单点登录（SSO）系统，允许用户使用同一组凭据访问多个应用和系统。



*04*

**总结**



综上所述，http基本鉴权存在安全问题，不建议在企业使用，建议内部非涉密系统使用；Cookie+Session相对简单，建议在内网使用；token相对完善，推荐在外网使用；JWT推荐使用，常用在SSO单点登录中；OAuth灵活方便，对于第三方系统登录更友好。

![图片](assets/聊聊登录鉴权那些事儿/640.webp)



**作者简介**

赵荣荣，北银金科效能研发部前端开发工程师，精通后台管理系统的开发，目前在做北京银行官网的开发建设，有丰富的React、Vue、React Native开发经验。

**招聘启事**















![图片](assets/聊聊登录鉴权那些事儿/640-17335028774387.webp)



北银金融科技有限责任公司根植于北京银行，是一家致力于大数据、人工智能、云计算、区块链、物联网等新技术创新与金融科技应用的科技企业，公司充分发挥北京银行企业文化和技术积淀先天优势，通过对技术、场景、生态的完美融合，输出科技创新产品和技术服务。



**现诚邀优秀人才加盟**

**共享金融科技时代硕果**

**
**

![图片](assets/聊聊登录鉴权那些事儿/640-17335028774388.webp)



扫描此二维码

期待您的加入